<!DOCTYPE html>
<html>
<head>
  <title>Repeat</title>
  <link rel="stylesheet" href="/nouislider.min.css">
  <!-- <script src="/eel.js"></script> -->
  <script src="/nouislider.min.js"></script>
</head>
<body>
  <div class="root">
    <input id="selectFile" type="file" accept="audio/*" />
    <button class="togglePlayback" type="button">Play</button>
    <audio id="audio" controls="true"></audio>
    <div id="timeSelector" style="width: 400px; border: 1px solid blue"></div>
  </div>
  <script>
  var DURATION = 1, START = 0, END = 1;

  // Setup slider
  var timeSelector = document.getElementById("timeSelector");
  noUiSlider.create(timeSelector, {
    start: [0, 1],
    connect: true,
    range: {
      "min": [0],
      "max": [1],
    },
  });
  timeSelector.noUiSlider.on("change", function () {
    var values = timeSelector.noUiSlider.get();
    START = parseFloat(values[0]).toFixed(2);
    END = parseFloat(values[1]).toFixed(2);
  });

  // File upload actions
  function console_log (s) { return eel.console_log(JSON.stringify(s)); }
  var selectFile = document.getElementById("selectFile")
  var audio = document.getElementById("audio");

  selectFile.addEventListener("change", function () {
    if (audio.src) URL.revokeObjectURL(audio.src);
    var objectUrl = URL.createObjectURL(selectFile.files[0]);
    audio.src = objectUrl;
  });

  // Audio events
  audio.addEventListener("durationchange", function () {
    DURATION = audio.duration;
    updateSlider();
  });
  audio.addEventListener("timeupdate", function () {
    if (audio.currentTime > END) {
      audio.currentTime = START;
    }
  });

  // Misc functions
  function updateSlider () {
    timeSelector.noUiSlider.updateOptions({
      start: [0, DURATION],
      range: {
        "min": [0],
        "max": [DURATION],
      },
    });
  }
  </script>
</body>
</html>
